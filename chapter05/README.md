### 5장 인터럽트를 공부하는 방법
- 인터럽트 컨텍스트, 인터럽트 벡터가 제일 중요하다!
  
- 인터럽트 3가지 동작
	- arm architecture 관점(arm processor, exception 처리)
	- irq subsystem 관점
	- interrupt handler 관점

### 인터럽트란?
- 하드웨어 관점
	- 하드웨어의 변화를 감지해서 외부 입력으로 전달되는 전기 신호.
	- 보통 하드웨어 개발자들은 오실로스코프라는 장비로 인터럽트 신호가 제대로 올라오는지 측정.
- 소프트웨어 관점
	- 인터럽트가 발생하면 프로세스는 하던 일을 멈추고 '이미 정해진 코드'를 실행해서 하드웨어의 변화를 처리
	- '이미 정해진 코드': 인터럽트 벡터와 인터럽트 핸들러
	- 인터럽트가 발생하면 소프트웨어적으로 처리하는 과정은 인터럽트 서비스 루틴(Interrupt Service Routine)이라고 부름

- CPU 아키텍처 관점
	- 인터럽트는 CPU 아키텍처별로 다르게 처리
	- x86, ARMv7, ARMv8 아키텍처별로 인터럽트를 처리하는 방식이 다름
	- 라즈베리 파이는 ARMv7 기반 아키텍처이므로 ARMv7 CPU에서 인터럽트를 처리하는 과정을 파악하면 됨.
 
- ARMv7 아키텍처 기반 프로세서 관점
	- 인터럽트는 익셉션(Exception)의 한 종류로 처리
	- 외부 하드웨어 입력이나 오류 이벤트가 발생하면 익셉션 모드로 진입
	- 익셉션이 발생했다고 감지하면 익셉션 종류별로 이미 정해 놓은 주소로 브랜치
 
- ARMv7 기반 프로세서에서 익셉션 벡터(Exception Vector)처리 방식
	- 인터럽트나 소프트웨어적으로 심각한 오류가 발생하면 ARMv7 프로세스는'이미 정해진 주소'에 있는 코드를 실행
	- 이미 정해진 주소 코드를 익셉션 벡터(Exception vector)라 하며, 각 익셉션의 종류에 따라 주소의 위치가 다름
	- 인터럽트를 익셉션 벡터 중 하나의 모드로 처리

### 인터럽트 처리 방식에 대한 진실과 오해
- 인터럽트 핸들러를 빨리 실행해야 하는 이유는?
	- 인터럽트가 발생하면 프로세스(process)가 실행 중인 코드가 멈추기 때문
	- 리눅스 디바이스 드라이버나 커널 코드를 볼 때는 우리가 보고 있거나 실행하는 어떤 커널 코드도 인터럽트가 발생하면 인터럽트 벡터로 실행 흐름이 바뀔 수 있음

- 인터럽트 핸들러에서 처리해야 할 동작이 많으면 어떻게 해야 할까?
	- 인터럽트 후반부 기법을 활용하면 됨.

### 인터럽트 주요 개념
- 인터럽트 핸들러
- 인터럽트 벡터
- 인터럽트 디스크립터
- 인터럽트 컨텍스트

### 인터럽트 핸들러
- 인터럽트가 발생하면 이를 핸들링하기 위한 함수가 호출되는데 이를 인터럽트 핸들러라고 함.
- 키보드를 타이핑해서 인터럽트가 발생하면 키보드 인터럽트를 처리하는 키보드 인터럽트 핸들러가 호출
- 휴대폰에서 화면을 손으로 만지면 터치 인터럽트가 발생하고 터치 인터럽트를 처리하는 터치 인터럽트 핸들러가 호출

- 마우스 인터럽트 핸들러가 호출되는 과정(ARM architecture에 의존적임)
	- 마우스를 움직이면 마우스가 움직였다는 인터럽트가 발생해 인터럽트 벡터가 실행됨.
	- 커널의 인터럽트 내부 함수(IRQ 서브 시스템)에서 해당 인터럽트에 맞는 인터럽트 핸들러를 찾아 호출
	- 많은 하드웨어 디바이스가 이 같은 방식으로 인터럽트를 통해 하드웨어의 변화를 알림
 
- 리눅스 커널에서 구현된 익셉션 벡터
	- 0xFFFF0000 주소에 익셉션 종류 별로 익셉션 벡터 테이블 구현됨.
	- 0xFFFF0000 주소 기준으로 +0x18 주소에 인터럽트 벡터의 코드가 구현돼 있음.

- 인터럽트 디스크립터란
	- 인터럽트 종류별로 다음과 같은 인터럽트의 세부 속성을 관리하는 자료 구조
		- 인터럽트 핸들러
		- 인터럽트 핸들러 매개변수
		- 논리 인터럽트 번호
		- 인터럽트 실행 횟수
	- 프로세스의 세부 속성을 표현하는 자료구조가 태스크 디스크립터이듯이 인터럽트에 대한 속성 정보를 저장하는 자료구조가 인터럽트 디스크립터임.
	- 커널 인터럽트의 세부 함수에서는 인터럽트 디스크립터에 접근해 인터럽트 종류별로 세부적인 처리를 수행
