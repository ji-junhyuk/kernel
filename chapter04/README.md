### 해당 단원 학습 팁
1. 너무 정독하지 말기(전체를 보고 나면 더 확실히 이해)
2. 여러번 자주 읽기
3. 실습 꼭 하기
4. 실습을 프로젝트에 활용하기

### 프로세스를 배우는 지름길
1. 직접 간단한 커널 스레드 작성해보기
2. 커널 스레드 함수 개선해보기
3. `ftrace를 활용해 프로세스 디버깅을 자주 해보기`

### 프로세스
1. 프로세스간 무엇인가
- 프로세스란 `리눅스 시스템 메모리에서 실행 중인 프로그램`
```
프로세스가 실행을 대기한다면 실행할 때 어떤 과정을 거칠까?
프로세스는 어떤 구조체로 식별할까?
```
- 프로세스를 관리하는 자료구조이자 객체를 `태스크 디스크립터(task descriptor)`라고 부르고, `task_struct` 구조체로 표현된다.
	- 이 구조체에 프로세스가 쓰는 `메모리 리소스, 프로세스 이름, 실행 시각, 프로세스 아이디(pid), 프로세스 스택의 최상단 주소와 같은 속성 정보`가 저장돼 있다.
```
프로세스의 실행 흐름은 어느 구조체에 저장할 수 있을까?
```
- 프로세스의 실행 흐름을 표현하는 또 한가지 중요한 공간은 `프로세스 스택` 공간이다. 이 `프로세스 스택의 최상단 주소에thread_info 구조체`가 있다.

```
-000:__schedule()
-001:schedule_timeout()
-002:do_sigtimedwait()
-003:sys_rt_sigtimewait()
-004:ret_fast_syscall()
```
	- 함수 호출 방향은 004번째 줄에서 000번째 줄 방향
	- 유저 공간에서 sigtimewait() 함수를 호출하면 이에 대응하는 시스템 콜 핸들러 함수인 sys_rt_sigtimewait()
	- 000번째 줄의 __schedule()함수가 호출 돼 스케줄링된다.
- 프로세스는 함수를 호출하면서 함수를 실행한다. 함수를 호출하고 실행할 때 어떤 리소스를 쓸까? 바로, 프로세스 스택의 메모리 공간이다. `모든 프로세스들은 커널 공간에서 실행될 때 각자 스택 공간을 할당받으며 스택 공간 내에서 함수를 실행한다.`

### 태스크
- 기존 임베디드 RTOS 기반 시스템에서 특정 코드나 프로그램 실행을 일괄 처리했는데 이런 `실행 및 작업 단위를 테스크`라고 부름. (기존 임베디드개발자들이 리눅스를 사용하는 임베디드 프로젝트에 유입)
- 다음 함수는 모두 프로세스를 관리 및 제어하는 역할을 수행하며, 함수 이름에 보이는 `task는 process라고 바꿔도 무방`
	- dump_task_regs(), get_task_mm(), get_task_pid(), idle_task()

### 스레드
- 스레드는 `유저 레벨에서 생성된 가벼운 프로세스`
- 스레드는 자신이 속한 프로세스 내의 다른 스레드와 `파일 디스크립터. 파일 및 시그널 정보에 대한 주소 공간을 공유`
- 커널 입장에서는 스레드를 다른 프로세스와 동등하게 관리. 대신 각 프로세스 식별자인 태스크 디스크립터(task_struct)에서 스레드 그룹 여부를 점검

```TRACE32
v.v %all (struct task_struct*)0xf161800000

```
- task_struct에서 stack필드는 프로세스의 스택 최상단 주소를 의미한다.
```Trace32
v.v %all (struct thread_info*)0xF1604000
r											: 레지스터 정보 보기
v.f											: 콜 스택 보기
```
- `thread_info는 아키텍쳐에 의존적인 프로세스의 동작`이다.
- `프로세스의 실행 흐름을 나타내는 주요 레지스터`
	- 스택 포인터 레지스터와(sp)과 프로그램 카운터 레지스터(pc)
	- 두 개의 레지스터(sp, pc)를 암코어 레지스터에 로딩하기
```Trace32
r.s	sp 0xF1605E40
r.s pc 0XC0FF4658
```
- log
	- freezable_schedule ...
	- sys_epoll ...
	- ref_fast_syscall
- `thread_info 구조체 내`에 `cpu_context_field는 레지스터 셋트 정보`를 담고 있다. `레지스터 셋트는 프로그램 실행 정보를 저장하는 중요한 자료구조`이다.
